<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Game Of Life (backbone.js, protobufs, golang)</title>
  <style>
	.alive {background-color:black;}
	.dead {background-color:yellow;}

	td,th {
  	min-width: 3em; /* the normal 'fixed' width */
  	width: 3em; /* the normal 'fixed' width */
  	max-width: 3em; /* the normal 'fixed' width, to stop the cells expanding */

  	min-height: 3em; /* the normal 'fixed' width */
  	height: 3em; /* the normal 'fixed' width */
  	max-height: 3em; /* the normal 'fixed' width, to stop the cells expanding */  	
	}
  </style>
</head>
<body>
  <!-- ========= -->
  <!-- Your HTML -->
  <!-- ========= -->

  <div id="container">Loading...</div>

  <!-- ========= -->
  <!-- Libraries -->
  <!-- ========= -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
  
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.1.9/backbone.localStorage-min.js" type="text/javascript"></script>

  <!-- =============== -->
  <!-- Javascript code -->
  <!-- =============== -->
  <script type="text/javascript">

	function sleep(milliseconds) {
	  var start = new Date().getTime();
	  for (var i = 0; i < 1e7; i++) {
	    if ((new Date().getTime() - start) > milliseconds){
	      break;
	    }
	  }
	}

    var BoardModel = Backbone.Model.extend({
    	urlRoot: '/new/10'
	});

    var AppView = Backbone.View.extend({
      // el - stands for element. Every view has a element associate in with HTML content will be rendered.
      el: '#container',

      // First function called when view is instantiated.
      initialize: function(){
      	this.listenTo(this.model, 'change', this.render);
      	this.model.fetch();
      },

      // $el - it's a cached jQuery object (el), in which you can use jQuery functions to push content. Like the Hello World in this case.
      render: function(){
      	console.log(this.model);
      	var states = this.model.attributes.States;
      	var html = "<table>";
      	for (var row = 0; row < states.length; row++) {
      		html += "<tr>";
      		for (var cell = 0; cell < states[row].length; cell++) {
      			html += "<td class='";
      			if (states[row][cell]) {
      				html += "alive";
      			} else {
					html += "dead";
      			}
      			html += "''></td>";
      		}
      		html += "</tr>";
    	}
    	html += "</table>";
        this.$el.html(html);
        sleep(1000);
        this.model.save();
      }
    });

	var boardModel = new BoardModel();
    var appView = new AppView({model: boardModel});
  </script>

</body>
</html>